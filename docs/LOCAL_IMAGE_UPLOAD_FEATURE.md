# 📁 本地图片上传功能

## ✨ 功能说明

在后台添加/编辑商品时，现在支持**两种方式**添加商品主图：

1. **📎 URL链接** - 输入图片URL（自动压缩和缩放）
2. **📁 本地文件** - 选择本地图片文件（自动压缩和缩放）

## 🎯 使用方法

### 方式一：URL链接模式

1. 点击 **"📎 URL链接"** 按钮切换到URL模式
2. 在输入框中输入图片URL
3. 按 `Enter` 键或点击其他字段，系统会自动处理图片
4. 或点击 **"🔄 处理图片"** 按钮手动处理

### 方式二：本地文件模式（新增）

1. 点击 **"📁 本地文件"** 按钮切换到文件模式
2. 点击上传区域选择图片文件
3. 系统会自动处理图片（压缩和缩放）
4. 处理完成后显示处理信息和预览

## 📊 功能特点

### ✅ 本地文件上传
- **支持格式**: JPG、PNG、WebP 等常见图片格式
- **文件大小限制**: 最大10MB
- **自动处理**: 选择文件后自动压缩和缩放
- **文件信息**: 显示选择的文件名

### 🎨 智能处理
- **自动压缩**: 减小文件大小，提高加载速度
- **自动缩放**: 调整到合适尺寸（最大1200×1200px）
- **保持宽高比**: 不拉伸变形
- **统一格式**: 输出为JPEG格式

### 📈 处理信息显示
处理完成后显示：
- **原始尺寸** - 图片的原始宽度和高度
- **处理后尺寸** - 压缩后的宽度和高度
- **原始大小** - 原始文件大小（KB/MB）
- **处理后大小** - 压缩后的文件大小（KB/MB）
- **压缩率** - 文件大小减少的百分比

## 🎨 界面说明

### 切换按钮
- **📎 URL链接** - 切换到URL输入模式
- **📁 本地文件** - 切换到文件上传模式
- 当前模式会高亮显示

### 文件上传区域
- **未选择文件时**: 显示上传提示和图标
- **已选择文件时**: 显示文件名和"更换"按钮
- **悬停效果**: 鼠标悬停时边框变色

### 图片预览
- 显示处理后的图片预览
- 悬停显示"移除"按钮
- 点击可移除图片

## ⚙️ 处理参数

当前默认设置：
- **最大宽度**: 1200px
- **最大高度**: 1200px
- **压缩质量**: 85%
- **输出格式**: JPEG

## 💡 使用建议

### 推荐使用本地文件模式
- ✅ 更快速 - 无需等待网络加载
- ✅ 更安全 - 不依赖外部URL
- ✅ 更稳定 - 不受跨域限制影响
- ✅ 更便捷 - 直接选择本地文件

### URL模式适用场景
- 图片已托管在CDN或云存储
- 需要引用外部图片资源
- 图片URL稳定可靠

## 🛡️ 错误处理

### 文件类型错误
- 如果选择的不是图片文件，会提示"请选择图片文件！"

### 文件过大
- 如果文件超过10MB，会提示"图片文件过大，请选择小于10MB的图片！"

### 处理失败
- 如果图片处理失败，会显示错误提示
- 不会影响其他表单数据

## 🚀 技术实现

- 使用 `FileReader` API 读取本地文件
- 使用 `Canvas` API 进行图片处理
- 转换为 Data URL 格式存储
- 异步处理，不阻塞界面

## 📝 注意事项

1. **文件大小限制**
   - 建议上传小于10MB的图片
   - 超大图片会先压缩再处理

2. **浏览器兼容性**
   - 需要支持 File API 和 Canvas API
   - 现代浏览器都支持

3. **数据存储**
   - 处理后的图片以 Data URL 形式存储
   - 适合中小型图片（<5MB）
   - 超大图片建议先压缩再上传

4. **编辑商品**
   - 如果商品已有图片（data URL），会自动切换到文件模式
   - 如果商品图片是URL，会保持在URL模式

## 🎉 优势

- ✅ **双重选择** - URL和本地文件两种方式
- ✅ **自动处理** - 选择文件后自动压缩和缩放
- ✅ **用户友好** - 清晰的界面和提示
- ✅ **性能优化** - 压缩后的图片加载更快
- ✅ **统一尺寸** - 所有商品图片尺寸一致

